<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MF Portfolio Tracker</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 20px; background: #f0f2f5; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* Search Box Styles */
        .search-section { margin-bottom: 25px; position: relative; }
        input[type="text"] { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        #fund-results { 
            position: absolute; width: 100%; max-height: 200px; overflow-y: auto; 
            background: white; border: 1px solid #ddd; z-index: 10; display: none;
        }
        .result-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .result-item:hover { background: #e7f3ff; }

        /* Table Styles */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background: #007bff; color: white; }
        .btn-remove { color: #dc3545; cursor: pointer; font-weight: bold; }
        .controls { margin-top: 20px; display: flex; gap: 10px; }
        
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-refresh { background: #28a745; color: white; }
        .btn-reset { background: #6c757d; color: white; }
    </style>
</head>
<body>

<div class="container">
    <h2>MF Portfolio Tracker</h2>

    <div class="search-section">
        <label><strong>Box 1: Search Fund Name</strong></label>
        <input type="text" id="fund-search" placeholder="Type fund name (e.g. Axis Bluechip)..." onkeyup="searchFunds()">
        <div id="fund-results"></div>
    </div>

    <table id="portfolio-table">
        <thead>
            <tr>
                <th>Sr. No</th>
                <th>Fund Name</th>
                <th>Current NAV</th>
                <th>Investment (Cost)</th>
                <th>P & L</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <div class="controls">
        <button class="btn-refresh" onclick="refreshNAV()">Refresh NAV</button>
        <button class="btn-reset" onclick="resetAll()">Reset All</button>
    </div>
</div>

<script>
    let portfolio = [];

    // 1. Fetch & Filter Funds (Using api.mfapi.in for real data)
    async function searchFunds() {
        const query = document.getElementById('fund-search').value;
        const resultBox = document.getElementById('fund-results');
        
        if (query.length < 3) { resultBox.style.display = 'none'; return; }

        const response = await fetch(`https://api.mfapi.in/mf/search?q=${query}`);
        const data = await response.json();
        
        resultBox.innerHTML = '';
        resultBox.style.display = 'block';

        data.slice(0, 10).forEach(fund => {
            const div = document.createElement('div');
            div.className = 'result-item';
            div.innerText = fund.schemeName;
            div.onclick = () => addFund(fund.schemeCode, fund.schemeName);
            resultBox.appendChild(div);
        });
    }

    // 2. Add Fund to Table
    async function addFund(code, name) {
        const response = await fetch(`https://api.mfapi.in/mf/${code}`);
        const data = await response.json();
        const nav = data.data[0].nav;

        const fundEntry = { code, name, nav, investment: 0 };
        portfolio.push(fundEntry);
        
        document.getElementById('fund-results').style.display = 'none';
        document.getElementById('fund-search').value = '';
        renderTable();
    }

    // 3. Render Table
    function renderTable() {
        const tbody = document.querySelector('#portfolio-table tbody');
        tbody.innerHTML = '';

        portfolio.forEach((fund, index) => {
            const pandl = fund.investment > 0 ? (fund.nav - (fund.investment / 100)).toFixed(2) : "0.00"; // Simplified logic
            
            const row = `
                <tr>
                    <td>${index + 1}</td>
                    <td>${fund.name}</td>
                    <td>₹${fund.nav}</td>
                    <td><input type="number" value="${fund.investment}" onchange="updateInvest(${index}, this.value)"></td>
                    <td>₹${calculatePL(fund)}</td>
                    <td><span class="btn-remove" onclick="removeFund(${index})">Remove</span></td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    function updateInvest(index, val) {
        portfolio[index].investment = parseFloat(val);
        renderTable();
    }

    function calculatePL(fund) {
        // Simple P&L: For demo, assuming investment is "purchase price" per unit
        if (!fund.investment) return "0.00";
        return (fund.nav - fund.investment).toFixed(2);
    }

    function removeFund(index) {
        portfolio.splice(index, 1);
        renderTable();
    }

    async function refreshNAV() {
        for (let fund of portfolio) {
            const response = await fetch(`https://api.mfapi.in/mf/${fund.code}`);
            const data = await response.json();
            fund.nav = data.data[0].nav;
        }
        renderTable();
        alert("NAV Updated!");
    }

    function resetAll() {
        portfolio = [];
        renderTable();
    }
</script>

</body>
</html>
